import streamlit as st

def predict(sample):
    if sample['Impressions'] <= 4454.5:
        if sample['Clicks'] <= 2658.0:
            if sample['Clicks'] <= 1417.0:
                if sample['Clicks'] <= 667.5:
                    if sample['Clicks'] <= 337.0:
                        if sample['Impressions'] <= 1714.5:
                            return [[0.176807034025249]]
                        else:
                            if sample['Clicks'] <= 224.0:
                                if sample['Device_Type'] <= 2.5:
                                    return [[0.06226899213269166]]
                                else:
                                    return [[0.03231225259020127]]
                            else:
                                return [[0.0850712521521644]]
                    else:
                        if sample['Impressions'] <= 2366.5:
                            if sample['Impressions'] <= 1300.0:
                                return [[0.3983363938146053]]
                            else:
                                if sample['Clicks'] <= 474.0:
                                    return [[0.20912731414098515]]
                                else:
                                    return [[0.28924952848066604]]
                        else:
                            if sample['Clicks'] <= 554.5:
                                if sample['Impressions'] <= 3372.0:
                                    return [[0.15809396715480745]]
                                else:
                                    return [[0.11799107000843746]]
                            else:
                                return [[0.20634970930486496]]
                else:
                    if sample['Impressions'] <= 2036.0:
                        if sample['Clicks'] <= 1205.0:
                            if sample['Month'] <= 5.5:
                                return [[0.7027876197259437]]
                            else:
                                if sample['Impressions'] <= 1675.0:
                                    return [[0.5808618888376107]]
                                else:
                                    return [[0.45747021677971594]]
                        else:
                            return [[0.8534303966213561]]
                    else:
                        if sample['Clicks'] <= 1090.0:
                            if sample['Impressions'] <= 3448.0:
                                if sample['Impressions'] <= 2528.5:
                                    return [[0.3797744901025191]]
                                else:
                                    return [[0.30405029476389117]]
                            else:
                                return [[0.22694367630407955]]
                        else:
                            if sample['Impressions'] <= 3180.5:
                                return [[0.4677911749863895]]
                            else:
                                if sample['Impressions'] <= 3763.5:
                                    return [[0.37386377804041393]]
                                else:
                                    return [[0.3254403990755934]]
            else:
                if sample['Impressions'] <= 2186.0:
                    if sample['Impressions'] <= 1449.5:
                        if sample['Campaign_Type'] <= 3.5:
                            return [[1.8334850456040985]]
                        else:
                            return [[1.4434163811688354]]
                    else:
                        if sample['Clicks'] <= 2152.5:
                            if sample['Clicks'] <= 1683.0:
                                return [[0.8657618359561404]]
                            else:
                                if sample['Impressions'] <= 1686.0:
                                    return [[1.1628640267393766]]
                                else:
                                    return [[1.0569411244272562]]
                        else:
                            if sample['Impressions'] <= 1701.0:
                                return [[1.4261089152393498]]
                            else:
                                return [[1.1922282577066976]]
                else:
                    if sample['Impressions'] <= 2902.5:
                        if sample['Clicks'] <= 1720.0:
                            return [[0.5976414498226782]]
                        else:
                            if sample['Campaign_Type'] <= 1.5:
                                return [[0.6466302367941712]]
                            else:
                                if sample['Impressions'] <= 2873.5:
                                    return [[0.8453254116715652]]
                                else:
                                    return [[0.7331581188203359]]
                    else:
                        if sample['Conversion_Rate'] <= 0.0012798885290976614:
                            return [[1.075761811573945]]
                        else:
                            if sample['Clicks'] <= 2190.5:
                                if sample['Impressions'] <= 3307.0:
                                    return [[0.585773372730829]]
                                else:
                                    return [[0.46275590048254933]]
                            else:
                                if sample['Impressions'] <= 3269.5:
                                    return [[0.4437289175099663]]
                                else:
                                    return [[0.6522077997999952]]
        else:
            if sample['Impressions'] <= 2146.0:
                if sample['Impressions'] <= 1213.5:
                    if sample['Clicks'] <= 3766.5:
                        return [[2.812554098598069]]
                    else:
                        return [[3.9706637149525252]]
                else:
                    if sample['Clicks'] <= 3681.5:
                        if sample['Conversion_Rate'] <= 0.2827996611595154:
                            if sample['Impressions'] <= 1593.5:
                                if sample['Impressions'] <= 1391.5:
                                    return [[2.476460276279565]]
                                else:
                                    return [[2.0838414534442244]]
                            else:
                                return [[1.6978803364514385]]
                        else:
                            return [[0.6901639344262295]]
                    else:
                        if sample['Impressions'] <= 1738.0:
                            if sample['Clicks'] <= 3935.5:
                                return [[2.5815257295175007]]
                            else:
                                if sample['Clicks'] <= 4936.5:
                                    return [[3.0038801411096894]]
                                else:
                                    return [[3.560593836962904]]
                        else:
                            if sample['Impressions'] <= 1874.0:
                                return [[2.485343232774263]]
                            else:
                                if sample['Clicks'] <= 4687.0:
                                    return [[2.08300842567999]]
                                else:
                                    return [[2.429437690845192]]
            else:
                if sample['Impressions'] <= 3340.5:
                    if sample['Clicks'] <= 3758.0:
                        if sample['Impressions'] <= 2600.5:
                            if sample['Impressions'] <= 2283.5:
                                return [[1.4564077624119633]]
                            else:
                                if sample['Clicks'] <= 3203.0:
                                    return [[1.2058333423289729]]
                                else:
                                    return [[1.311421069721127]]
                        else:
                            if sample['Clicks'] <= 3177.4000244140625:
                                if sample['Clicks'] <= 3150.4000244140625:
                                    return [[1.0073807140073325]]
                                else:
                                    return [[0.5411071077628562]]
                            else:
                                if sample['Impressions'] <= 2803.0:
                                    return [[1.2994000076737902]]
                                else:
                                    return [[1.1595447119757527]]
                    else:
                        if sample['Impressions'] <= 2455.0:
                            if sample['Clicks'] <= 4655.5:
                                return [[1.8147986235481985]]
                            else:
                                return [[2.1640340193115337]]
                        else:
                            if sample['Impressions'] <= 2998.5:
                                if sample['Clicks'] <= 4496.5:
                                    return [[1.539962289644404]]
                                else:
                                    return [[1.7474675023910884]]
                            else:
                                if sample['Clicks'] <= 4407.0:
                                    return [[1.286325763358626]]
                                else:
                                    return [[1.4732450898123108]]
                else:
                    if sample['Clicks'] <= 3719.5:
                        if sample['Clicks'] <= 3436.5:
                            if sample['Impressions'] <= 3830.5:
                                if sample['Clicks'] <= 2928.0:
                                    return [[0.7725939124696808]]
                                else:
                                    return [[0.8707417022301338]]
                            else:
                                if sample['Clicks'] <= 2915.5:
                                    return [[0.6700212413494294]]
                                else:
                                    return [[0.7494958026314451]]
                        else:
                            if sample['Impressions'] <= 3970.0:
                                return [[0.9927866222560188]]
                            else:
                                return [[0.8602333435871001]]
                    else:
                        if sample['Impressions'] <= 3617.5:
                            return [[1.2180111772114097]]
                        else:
                            if sample['Clicks'] <= 4444.0:
                                if sample['Impressions'] <= 4296.0:
                                    return [[1.0512200186318377]]
                                else:
                                    return [[0.96328148260991]]
                            else:
                                return [[1.1325635119927728]]
    else:
        if sample['Impressions'] <= 16630.0:
            if sample['Clicks'] <= 2443.0:
                if sample['Clicks'] <= 1329.0:
                    if sample['Clicks'] <= 705.0:
                        if sample['Clicks'] <= 304.0:
                            if sample['Clicks'] <= 162.5:
                                if sample['Impressions'] <= 9308.5:
                                    return [[0.01485711991924099]]
                                else:
                                    return [[0.008016626530878904]]
                            else:
                                if sample['Impressions'] <= 8267.0:
                                    return [[0.03719171457904116]]
                                else:
                                    return [[0.019778424813594552]]
                        else:
                            if sample['Impressions'] <= 8601.0:
                                if sample['Clicks'] <= 404.5:
                                    return [[0.05840056736874186]]
                                else:
                                    return [[0.09159434986188401]]
                            else:
                                if sample['Clicks'] <= 491.0:
                                    return [[0.033040863664188645]]
                                else:
                                    return [[0.04999091972081879]]
                    else:
                        if sample['Impressions'] <= 8187.0:
                            if sample['Impressions'] <= 5411.0:
                                if sample['Clicks'] <= 990.5:
                                    return [[0.17740660681888074]]
                                else:
                                    return [[0.23447979379595735]]
                            else:
                                if sample['Clicks'] <= 918.5:
                                    return [[0.12010980841199621]]
                                else:
                                    return [[0.16819668341667116]]
                        else:
                            if sample['Impressions'] <= 10631.5:
                                if sample['Clicks'] <= 933.5:
                                    return [[0.09114494460996471]]
                                else:
                                    return [[0.11911552355075856]]
                            else:
                                if sample['Clicks'] <= 997.0:
                                    return [[0.064228474832678]]
                                else:
                                    return [[0.0850299397074251]]
                else:
                    if sample['Impressions'] <= 8192.0:
                        if sample['Clicks'] <= 1852.5:
                            if sample['Impressions'] <= 6453.5:
                                if sample['Impressions'] <= 5008.5:
                                    return [[0.3320196953273437]]
                                else:
                                    return [[0.2776196787094745]]
                            else:
                                if sample['Clicks'] <= 1595.5:
                                    return [[0.20468668355066397]]
                                else:
                                    return [[0.24913464602497676]]
                        else:
                            if sample['Impressions'] <= 6108.5:
                                if sample['Impressions'] <= 5079.5:
                                    return [[0.45067173538734995]]
                                else:
                                    return [[0.3890876691527639]]
                            else:
                                if sample['Impressions'] <= 7309.5:
                                    return [[0.31654966290166436]]
                                else:
                                    return [[0.28286954383915064]]
                    else:
                        if sample['Impressions'] <= 11271.0:
                            if sample['Clicks'] <= 1886.0:
                                if sample['Clicks'] <= 1511.5:
                                    return [[0.1570037584356271]]
                                else:
                                    return [[0.1755272261914896]]
                            else:
                                if sample['Impressions'] <= 9738.0:
                                    return [[0.2564347890618724]]
                                else:
                                    return [[0.20303889675885575]]
                        else:
                            if sample['Clicks'] <= 2054.5:
                                if sample['Clicks'] <= 1706.0:
                                    return [[0.109439470747689]]
                                else:
                                    return [[0.13251834866788068]]
                            else:
                                if sample['Impressions'] <= 13001.0:
                                    return [[0.19579491062257387]]
                                else:
                                    return [[0.15526768619860665]]
            else:
                if sample['Impressions'] <= 7293.0:
                    if sample['Clicks'] <= 3932.0:
                        if sample['Clicks'] <= 3192.0:
                            if sample['Conversion_Rate'] <= 0.29789821058511734:
                                if sample['Impressions'] <= 5897.0:
                                    return [[0.549679449899913]]
                                else:
                                    return [[0.4293109753931485]]
                            else:
                                return [[0.0511780610274237]]
                        else:
                            if sample['Impressions'] <= 5382.5:
                                if sample['Impressions'] <= 4715.0:
                                    return [[0.772753164855182]]
                                else:
                                    return [[0.6817745917499862]]
                            else:
                                if sample['Impressions'] <= 6156.0:
                                    return [[0.6122322123043139]]
                                else:
                                    return [[0.5456541538037735]]
                    else:
                        if sample['Impressions'] <= 5682.0:
                            if sample['Clicks'] <= 4905.0:
                                if sample['Impressions'] <= 4813.5:
                                    return [[0.942244694582567]]
                                else:
                                    return [[0.8492057792322746]]
                            else:
                                return [[1.0102081910986982]]
                        else:
                            if sample['Impressions'] <= 6328.5:
                                if sample['Clicks'] <= 4527.5:
                                    return [[0.7158907116697916]]
                                else:
                                    return [[0.794122251655719]]
                            else:
                                if sample['Clicks'] <= 4626.5:
                                    return [[0.6318450338385233]]
                                else:
                                    return [[0.7031047468515071]]
                else:
                    if sample['Impressions'] <= 10712.0:
                        if sample['Clicks'] <= 3622.0:
                            if sample['Impressions'] <= 8478.5:
                                if sample['Clicks'] <= 3153.5:
                                    return [[0.3578079334394425]]
                                else:
                                    return [[0.43179275185428717]]
                            else:
                                if sample['Clicks'] <= 2929.5:
                                    return [[0.2767959943360125]]
                                else:
                                    return [[0.34257633271505256]]
                        else:
                            if sample['Impressions'] <= 8666.5:
                                if sample['Clicks'] <= 4424.5:
                                    return [[0.4976636317893529]]
                                else:
                                    return [[0.5803348307022734]]
                            else:
                                if sample['Clicks'] <= 4596.0:
                                    return [[0.42706138883572636]]
                                else:
                                    return [[0.49375298450960925]]
                    else:
                        if sample['Clicks'] <= 3676.0:
                            if sample['Impressions'] <= 13984.0:
                                if sample['Clicks'] <= 3011.0:
                                    return [[0.22790833654120363]]
                                else:
                                    return [[0.2705677915765607]]
                            else:
                                if sample['Clicks'] <= 3030.5:
                                    return [[0.18099350862722274]]
                                else:
                                    return [[0.22125193541309282]]
                        else:
                            if sample['Impressions'] <= 13479.5:
                                if sample['Clicks'] <= 4339.0:
                                    return [[0.3303254388070354]]
                                else:
                                    return [[0.381905073752679]]
                            else:
                                if sample['Clicks'] <= 4329.5:
                                    return [[0.26683357713176725]]
                                else:
                                    return [[0.3072150334468336]]
        else:
            if sample['Clicks'] <= 2398.5:
                if sample['Clicks'] <= 1177.5:
                    if sample['Impressions'] <= 36125.0:
                        if sample['Clicks'] <= 674.0:
                            if sample['Clicks'] <= 322.5:
                                if sample['Clicks'] <= 188.5:
                                    return [[0.004717549475385113]]
                                else:
                                    return [[0.0110392327498476]]
                            else:
                                if sample['Clicks'] <= 462.5:
                                    return [[0.016112013257797285]]
                                else:
                                    return [[0.022490593397768762]]
                        else:
                            if sample['Impressions'] <= 22349.5:
                                if sample['Clicks'] <= 921.5:
                                    return [[0.04198304052987495]]
                                else:
                                    return [[0.05344776947615033]]
                            else:
                                if sample['Clicks'] <= 1004.5:
                                    return [[0.029105839690996574]]
                                else:
                                    return [[0.03835810262526376]]
                    else:
                        if sample['Clicks'] <= 506.5:
                            if sample['Clicks'] <= 246.0:
                                if sample['Clicks'] <= 158.5:
                                    return [[0.0016535230489724737]]
                                else:
                                    return [[0.0032732790699523135]]
                            else:
                                if sample['Impressions'] <= 55007.5:
                                    return [[0.008395687313654353]]
                                else:
                                    return [[0.005028735183234866]]
                        else:
                            if sample['CPM'] <= 146.3112335205078:
                                if sample['Impressions'] <= 64879.5:
                                    return [[0.017340004246566725]]
                                else:
                                    return [[0.010288906516455731]]
                            else:
                                return [[0.1079138846000237]]
                else:
                    if sample['Impressions'] <= 37415.69921875:
                        if sample['Impressions'] <= 37370.69921875:
                            if sample['Impressions'] <= 25729.0:
                                if sample['Clicks'] <= 1706.5:
                                    return [[0.0687887452428918]]
                                else:
                                    return [[0.09726287848649946]]
                            else:
                                if sample['Clicks'] <= 1761.5:
                                    return [[0.047165130868692444]]
                                else:
                                    return [[0.06776100082118314]]
                        else:
                            return [[0.4526704298740773]]
                    else:
                        if sample['Impressions'] <= 60573.0:
                            if sample['CPM'] <= 141.13706970214844:
                                if sample['Clicks'] <= 1779.5:
                                    return [[0.030709035054280808]]
                                else:
                                    return [[0.04401393556719425]]
                            else:
                                return [[0.16102631594136804]]
                        else:
                            if sample['Clicks'] <= 1876.2000122070312:
                                if sample['Impressions'] <= 77578.0:
                                    return [[0.022237245258743297]]
                                else:
                                    return [[0.017558349005088507]]
                            else:
                                if sample['Impressions'] <= 79609.0:
                                    return [[0.031082684463052013]]
                                else:
                                    return [[0.02390497219011672]]
            else:
                if sample['Impressions'] <= 32773.0:
                    if sample['Clicks'] <= 3736.0:
                        if sample['Impressions'] <= 24816.0:
                            if sample['Clicks'] <= 2721.5:
                                if sample['Conversion_Rate'] <= 0.29838627576828003:
                                    return [[0.12168229848862547]]
                                else:
                                    return [[0.0083702084555099]]
                            else:
                                if sample['Clicks'] <= 2727.5:
                                    return [[0.404542755344418]]
                                else:
                                    return [[0.15768271651565743]]
                        else:
                            if sample['CPM'] <= 198.5391616821289:
                                if sample['Clicks'] <= 2909.5:
                                    return [[0.09041656109502343]]
                                else:
                                    return [[0.1115673976110161]]
                            else:
                                return [[0.8337670787247885]]
                    else:
                        if sample['Impressions'] <= 24091.2998046875:
                            if sample['Impressions'] <= 24076.7998046875:
                                if sample['Impressions'] <= 19504.5:
                                    return [[0.23726414688166758]]
                                else:
                                    return [[0.20188137580562063]]
                            else:
                                return [[0.7952380952380952]]
                        else:
                            if sample['Impressions'] <= 28403.0:
                                if sample['Clicks'] <= 4360.5:
                                    return [[0.15666056759401056]]
                                else:
                                    return [[0.1786094647866445]]
                            else:
                                if sample['Clicks'] <= 4378.5:
                                    return [[0.1338638517873969]]
                                else:
                                    return [[0.1533180080398852]]
                else:
                    if sample['CPM'] <= 189.68384552001953:
                        if sample['Impressions'] <= 59825.0:
                            if sample['Clicks'] <= 3585.0:
                                if sample['Impressions'] <= 43003.0:
                                    return [[0.07930823953690057]]
                                else:
                                    return [[0.059033170494830416]]
                            else:
                                if sample['Impressions'] <= 44165.0:
                                    return [[0.11092526576466567]]
                                else:
                                    return [[0.08399022578244597]]
                        else:
                            if sample['Clicks'] <= 3811.5:
                                if sample['CPM'] <= 97.1529769897461:
                                    return [[0.03996456401777911]]
                                else:
                                    return [[0.34439064023679333]]
                            else:
                                if sample['Impressions'] <= 78140.5:
                                    return [[0.06462808239112745]]
                                else:
                                    return [[0.05001253147710975]]
                    else:
                        return [[0.7553590197767748]]


def predict_ad_engagement(sample):
    result = predict(sample)       
    ctr_value = result[0][0]      

    if ctr_value < 0.015:
        engagement = "Low Engagement"
    elif ctr_value < 0.045:
        engagement = "Medium Engagement"
    else:
        engagement = "High Engagement"

    return ctr_value, engagement


st.title("🎯 Customer Ad Engagement Prediction")

st.write("Enter campaign details to predict CTR and engagement level:")

# User input fields
impressions = st.number_input("Impressions", min_value=0.0, step=1.0)
clicks = st.number_input("Clicks", min_value=0.0, step=1.0)
conversion_rate = st.number_input("Conversion Rate", min_value=0.0, max_value=1.0, step=0.001)
device_type = st.selectbox("Device Type", ["Desktop", "Mobile", "Tablet"])
campaign_type = st.selectbox("Campaign Type", ["LinkedIn", "Meta Ads", "Display", "Google Search", "Email"])
month = st.number_input("Month", min_value=1, max_value=12, step=1)
cpm = st.number_input("CPM", min_value=0.0, step=0.01)

device_map = {"Desktop": 1, "Mobile": 2, "Tablet": 3}
campaign_map = {"LinkedIn": 1, "Meta Ads": 2, "Display": 3, "Google Search": 4, "Email": 5}


if st.button("Predict Engagement"):
    input_data = {
        "Impressions": impressions,
        "Clicks": clicks,
        "Conversion_Rate": conversion_rate,
        "Device_Type": device_map[device_type],
        "Campaign_Type": campaign_map[campaign_type],
        "Month": month,
        "CPM": cpm
    }

    ctr, engagement = predict_ad_engagement(input_data)

    st.info(f"Predicted CTR: {ctr:.4f}")
    st.success(f"Predicted Customer Ad Engagement: {engagement}")
